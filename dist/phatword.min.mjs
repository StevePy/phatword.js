let Sensitivity=Object.freeze({Level1:Symbol("Level1"),Level2:Symbol("Level2"),Level3:Symbol("Level3")});class Password{#keyDownBuffer=[];#buffer=[];#times=[];#skinny="";#phat="";#ms=0;#recordEnter=!0;#sensitivities=[Sensitivity.Level1,Sensitivity.Level2,Sensitivity.Level3];#sensitivity=Sensitivity.Level2;#input=null;#submitButton=null;#controlKeys=["ShiftLeft","ShiftRight","ControlLeft","ControlRight","AltLeft","AltRight"];#ignoreKeys=["CapsLock","Tab","NumLock"];#submitKeys=["Enter","NumpadEnter"];constructor(input,submitButton,options){if(!(input instanceof HTMLInputElement||"text"==input.type&&"password"==input.type))throw new Error("Passwords can only be associated to text or password input controls.");this.#input=input,this.#input.addEventListener("focus",this.clear.bind(this)),this.#input.addEventListener("keydown",this.#onKeyDown.bind(this)),this.#input.addEventListener("keyup",this.#onKeyUp.bind(this)),null!=submitButton&&submitButton instanceof HTMLButtonElement&&(this.#submitButton=submitButton),null!=options&&null!=options.sensitivity&&this.setSensitivity(options.sensitivity),null!=options&&null!=options.recordEnter&&this.setRecordEnter(options.recordEnter)}getSensitivity(){return this.#sensitivity}setSensitivity(value){this.#sensitivities.includes(value)&&(this.#sensitivity=value)}getRecordEnter(){return this.#recordEnter}setRecordEnter(value){null!=value&&"boolean"==typeof value&&(this.#recordEnter=value)}clear(){this.#buffer=[],this.#keyDownBuffer=[],this.#times=[]}#onKeyDown(e){e.isComposing||this.#isIgnorable(e)||this.#submitKeys.includes(e.code)&&!this.#recordEnter||(this.#controlKeys.includes(e.code)||this.#sensitivity==Sensitivity.Level3?this.#buffer.push("[Down]"+this.#getKey(e)):this.#sensitivity==Sensitivity.Level2&&this.#keyDownBuffer.push(e))}#onKeyUp(e){e.isComposing||this.#isIgnorable(e)||(("Backspace"==e.code||"Delete"==e.code||e.getModifierState&&!e.getModifierState("NumLock")&&"NumpadDecimal"==e.code)&&""===this.#input.value?this.clear():(this.#submitKeys.includes(e.code)&&!this.#recordEnter||(this.#times.push(Date.now()),this.#controlKeys.includes(e.code)||this.#sensitivity!=Sensitivity.Level2?(0<this.#keyDownBuffer.length&&(this.#buffer=this.#buffer.concat(this.#keyDownBuffer.map(x=>`[Down]${this.#getKey(x)}[Up]`+this.#getKey(x))),this.#keyDownBuffer=[]),this.#buffer.push("[Up]"+this.#getKey(e))):0<this.#keyDownBuffer.length&&this.#keyDownBuffer.slice(-1)[0].code==e.code&&(this.#buffer=this.#buffer.concat(this.#keyDownBuffer.map(x=>`[Down]${this.#getKey(x)}[Up]`+this.#getKey(x))),this.#keyDownBuffer=[]),this.#skinny=this.#input.value,this.#phat=this.#buffer.join("")),this.#submitKeys.includes(e.code)&&null!=this.#submitButton&&this.#submitButton.click()))}#isIgnorable(e){return!!(e.isComposing||this.#ignoreKeys.includes(e.code)||e.repeat&&this.#controlKeys.includes(e.code)||this.#sensitivity==Sensitivity.Level1&&this.#controlKeys.includes(e.code))}#getKey(e){return`[${e.code}${e.shiftKey?"+S":""}${e.getModifierState&&e.getModifierState("CapsLock")?"+C":""}]`}time(){return 0==this.#ms&&this.#calcTime(),this.#ms}value(){return this.#calcTime(),0==this.#buffer.length?"":(this.clear(),""+this.#skinny+this.#phat)}#calcTime(){if(0==this.#times.length)return 0;var start=this.#times[0],end=this.#times.slice(-1)[0];this.#ms=end-start}}export{Sensitivity,Password};